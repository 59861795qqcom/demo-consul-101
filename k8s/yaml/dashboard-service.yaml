apiVersion: apps/v1
kind: Deployment
metadata:
  name: dashboard-service-deployment
spec:
  selector:
    matchLabels:
      app: dashboard-service
  minReadySeconds: 5
  template:
    metadata:
      labels:
        app: dashboard-service
    spec:
      containers:
      - name: dashboard-service
        image: topfunky/dashboard-service:0.0.2
        ports:
        - containerPort: 9002
      # - name: dashboard-consul
      #   image: "consul:1.2.3"
      #   env:
      #     - name: HOST_IP
      #       valueFrom:
      #         fieldRef:
      #           fieldPath: status.hostIP
      #   command:
      #     - "/bin/sh"
      #     - "-ec"
      #     - |
      #       exec /bin/consul connect proxy \
      #         -http-addr=${HOST_IP}:8500 \
      #         -service=dashboard \
      #         -upstream="counting:9001"
      initContainers:
      - name: dashboard-init
        image: topfunky/dashboard-init:0.0.4
        env:
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
